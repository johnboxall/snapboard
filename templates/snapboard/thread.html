{% extends "snapboard/base_forum.html" %}

{% load extras %}

{% block snapboard_header %}
<b>
    <a href="/snapboard/threads/category/{{ thr.category.id }}">{{ thr.category }}</a>:
    {{ thr.subject }}
</b>
{% endblock %}

{% block snapboard_main %}
    <div id="thread_rpc_msg_div" class="rpc_message">
        <!-- This DIV is for RPC feedback messages for the whole thread-->
    </div>

    <span class="thread_menu">
        {% if user.is_staff %}
            <span>
                <a id="csticky{{ thr.id }}" href="#" onClick="set_csticky('{{ thr.id }}');">
                {% if thr.csticky %} unset {% else %} set {% endif %} csticky
                </a> 
            </span>
            &#149;
            <span>
                <a id="gsticky{{ thr.id }}" href="#" onClick="set_gsticky('{{ thr.id }}');">
                {% if thr.gsticky %} unset {% else %} set {% endif %} gsticky
                </a> 
            </span>
            &#149;
        {% endif %}
        {% if user.is_authenticated %}
            <span>
                <a id="watch{{ thr.id }}" href="#" onClick="set_watch('{{ thr.id }}');">
                {% if watched %} don't watch {% else %} watch {% endif %}
                </a> 
            </span>
        {% endif %}
    </span>
    <br />

    <div>
    {% for post in post_list %}
        <div id="post_rpc_msg_div{{ post.id }}" class="rpc_message">
            <!-- This DIV is for RPC feedback messages for individual posts -->
        </div>
        <p class="post_header">
            <span class="post_menuright">
                {% ifequal post.user_id user.id %}
                <span title="Edit this post.  All revisions are saved!" class="popup">
                    <b><a href="#" onclick="toggle_edit('{{ post.id }}')">edit post</a></b>
                </span>
                &#149;
                {% endifequal %}
                {% if user.is_staff %}
                <span title="ADMIN: mark this post for censorship" class="popup">
                    <a id="censor{{ post.id }}" href="#" onClick="set_censor('{{ post.id }}');">censor</a>
                </span>
                
                {% endif %}
                {% if user.is_authenticated %}
                <span title="Report this post for violation of forum policies." class="popup">
                    <a id="abuse{{ post.id }}" href="#" onClick="set_abuse('{{ post.id }}');">&#149; report abuse</a>
                </span>
                {% endif %}
            </span>

            [ICON]
            <b>
                <a href="#" onclick="toggle_post('{{ post.id }}');">
                    <span title="34 Posts; Moderator" class="popup">{{ post.user }}</span>
                </a>
            </b>

            <span class="timesince">
                {{ post.date|timesince }} ago
            </span>
            <span class="post_summary" style="display:none;" id="sum{{ post.id }}">:
                {{ post.text|post_summary:"30" }}
            </span>
        </p>

        <!-- POST -->
        <div style="display:block" id="post{{ post.id }}">


            <div style="display:block" id="post_text{{ post.id }}">
                {{ post.text|striptags }}
            </div>

            {% ifequal post.user_id user.id %}
            <div style="display:none" id="post_edit{{ post.id }}">
                <form action="/snapboard/edit_post/{{ post.id }}/" method="POST">
                <b>All revisions of this post are stored and publicly viewable.</b>
                {{ post.get_edit_form.as_p }}
                <input type="submit" value="Update">
                </form>
            </div>
            {% endifequal %}

            {% if post.previous %}
            <span class="post_menuleft">
                <a href="#">This message has been revised</a>
            </span>
            <br />
            {% endif %}

        </div>
        <hr class="postend" />
    {% endfor %}
    </div>

    {% if user.is_authenticated %}
    <!-- div style="border: 1px solid #ccc; padding: 5px; background: #efe" -->
    <form action="" method="POST">
        Got something to say?
        <br />
        {{ postform.as_p }}
        <input type="submit" value="Post">
    </form>
    {% else %}
    <p>You need to <a href="/login">sign in</a> to post messages.</p>
    {% endif %}

{% endblock %}
